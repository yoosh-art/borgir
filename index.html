<!DOCTYPE html>
<html>
    <head>
        <title>AR.js Fixed Z-Axis Movement</title>
        <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
        <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    </head>

    <body style="margin: 0; overflow: hidden;">
        <!-- Custom component to handle click-and-drag movement along the Z-axis -->
        <script>
            AFRAME.registerComponent('fixed-z-movement', {
                init: function () {
                    this.isDragging = false;
                    this.lastPosition = null;

                    this.onMouseDown = this.onMouseDown.bind(this);
                    this.onMouseUp = this.onMouseUp.bind(this);
                    this.onMouseMove = this.onMouseMove.bind(this);

                    this.el.addEventListener('mousedown', this.onMouseDown);
                    window.addEventListener('mouseup', this.onMouseUp);
                    window.addEventListener('mousemove', this.onMouseMove);
                },

                remove: function () {
                    this.el.removeEventListener('mousedown', this.onMouseDown);
                    window.removeEventListener('mouseup', this.onMouseUp);
                    window.removeEventListener('mousemove', this.onMouseMove);
                },

                onMouseDown: function (evt) {
                    this.isDragging = true;
                    // Prevent default behavior to avoid camera movement
                    evt.preventDefault();
                },

                onMouseUp: function () {
                    this.isDragging = false;
                    this.lastPosition = null;
                },

                onMouseMove: function (evt) {
                    if (!this.isDragging) { return; }

                    const cameraEl = this.el.sceneEl.camera.el;
                    const cameraPosition = cameraEl.object3D.position;

                    // Calculate the change in mouse Y position to map to Z-axis movement
                    const deltaY = evt.movementY || 0;
                    
                    // A simple multiplier to control the speed of movement
                    const movementSpeed = 0.005; 

                    // Get current position and apply the change only to the Z-axis
                    const currentPosition = this.el.getAttribute('position');
                    const newZ = currentPosition.z + (deltaY * movementSpeed);
                    
                    // Update the entity's position, keeping X and Y the same
                    this.el.setAttribute('position', {
                        x: currentPosition.x,
                        y: currentPosition.y,
                        z: newZ
                    });
                }
            });
        </script>

        <a-scene
            vr-mode-ui="enabled: false;"
            loading-screen="enabled: false;"
            renderer="logarithmicDepthBuffer: true;"
            arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
            id="scene"
            embedded
        >
            <a-assets>
                <!-- NOTE: The asset URL has been changed to a placeholder since the original is a relative path -->
                <a-asset-item
                    id="animated-asset"
                    src="https://cdn.glitch.global/6ac3164a-2f08-460d-8547-51f6e245a4a9/bowser.glb?v=1676646738012"
                ></a-asset-item>
            </a-assets>

            <a-marker
                id="animated-marker"
                type="pattern"
                preset="custom"
                url="https://raw.githubusercontent.com/AR-js-org/AR.js/master/aframe/examples/image-tracking/patterns/pattern-letterA.patt"
                raycaster="objects: .clickable"
                emitevents="true"
                cursor="fuse: false; rayOrigin: mouse;"
            >
                <!-- Apply the custom component for movement and a fixed scale -->
                <a-entity
                    id="bowser-model"
                    scale="1.25 1.25 1.25"
                    animation-mixer="loop: repeat"
                    gltf-model="#animated-asset"
                    class="clickable"
                    fixed-z-movement
                ></a-entity>
            </a-marker>

            <a-entity camera></a-entity>
        </a-scene>
    </body>
</html>
